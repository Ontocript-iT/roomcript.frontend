<div class="flex items-center gap-2 px-4 py-3 border-b border-gray-200 bg-gray-50">
  <button
    type="button"
    class="px-3 py-1.5 text-xs font-medium border border-gray-300 rounded-sm bg-white hover:bg-gray-100">
    <svg class="w-3 h-3 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
    </svg>
    Add Payment
  </button>
  <button
    type="button"
    class="px-3 py-1.5 text-xs font-medium border border-gray-300 rounded-sm bg-white hover:bg-gray-100">
    Add Charges
  </button>
  <button
    type="button"
    class="px-3 py-1.5 text-xs font-medium border border-gray-300 rounded-sm bg-white hover:bg-gray-100">
    Apply Discount
  </button>
  <button
    type="button"
    class="px-3 py-1.5 text-xs font-medium border border-gray-300 rounded-sm bg-white hover:bg-gray-100">
    Folio Operations
  </button>
  <button
    type="button"
    class="px-3 py-1.5 text-xs font-medium border border-gray-300 rounded-sm bg-white hover:bg-gray-100">
    Print Invoice
  </button>
  <button
    type="button"
    (click)="refreshSelectedFolio()"
    class="px-3 py-1.5 text-xs font-medium border border-gray-300 rounded-sm bg-white hover:bg-gray-100">
    <svg class="w-3 h-3 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
    </svg>
    Refresh
  </button>
  <button
    type="button"
    class="px-3 py-1.5 text-xs font-medium border border-gray-300 rounded-sm bg-white hover:bg-gray-100">
    More â–¼
  </button>
</div>

<!-- Two-column Layout -->
<div class="flex">
  <!-- Left Sidebar - Folio List -->
  <div class="w-64 border-r border-gray-200 bg-gray-50">

    <!-- Sidebar Header with Add Button -->
    <div class="px-3 py-2 border-b border-gray-200 flex items-center justify-between bg-white">
      <h3 class="text-xs font-semibold text-gray-700">Folio</h3>
      <button
        type="button"
        (click)="addNewFolio()"
        class="w-6 h-6 flex items-center justify-center border border-gray-300 rounded bg-white hover:bg-gray-50 hover:border-blue-400 transition-colors"
        title="Add New Folio">
        <svg class="w-3.5 h-3.5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading && folios.length === 0" class="p-4 text-center text-xs text-gray-500">
      <div class="animate-pulse">Loading folios...</div>
    </div>

    <!-- Folio List -->
    <div class="divide-y divide-gray-200" *ngIf="!loading || folios.length > 0">
      <div
        *ngFor="let folio of folios"
        class="px-3 py-2 cursor-pointer hover:bg-gray-100 transition-colors"
        [class.bg-blue-50]="selectedFolio?.id === folio.id"
        [class.border-l-2]="selectedFolio?.id === folio.id"
        [class.border-blue-500]="selectedFolio?.id === folio.id"
        (click)="selectFolio(folio)">

        <div class="flex items-start justify-between">
          <div class="flex-1 min-w-0">
            <!-- Folio Name and Guest -->
            <div class="flex items-center gap-1 mb-0.5">
              <!-- Master Folio Badge -->
              <span
                *ngIf="folio.isMasterFolio"
                class="px-1 py-0.5 text-[10px] font-semibold bg-purple-100 text-purple-700 rounded">
                MASTER
              </span>
            </div>

            <!-- Folio Number -->
            <div class="text-[11px] text-gray-500 truncate mb-1">
              {{ folio.folioNumber }}
            </div>
          </div>

          <!-- Arrow Icon -->
          <svg class="w-3 h-3 text-gray-400 flex-shrink-0 ml-2 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </div>
      </div>

      <!-- No Folios Message -->
      <div *ngIf="!loading && folios.length === 0" class="p-4 text-center">
        <svg class="w-12 h-12 mx-auto text-gray-300 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <p class="text-xs text-gray-500">No folios found</p>
        <p class="text-[10px] text-gray-400 mt-1">Click + to create a new folio</p>
      </div>
    </div>
  </div>

  <!-- Main Content - Charges Table -->
  <div class="flex-1 overflow-x-auto">
    <!-- Loading State -->
    <div *ngIf="loading && selectedFolio" class="p-8 text-center">
      <div class="animate-pulse text-gray-500">
        <svg class="w-8 h-8 mx-auto mb-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        <p class="text-sm">Loading folio details...</p>
      </div>
    </div>

    <!-- Show message if no folio is selected -->
    <div *ngIf="!selectedFolio && !loading" class="p-8 text-center">
      <svg class="w-16 h-16 mx-auto text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
      <p class="text-sm text-gray-600 font-medium">Select a folio to view details</p>
      <p class="text-xs text-gray-500 mt-1">Choose a folio from the list to view charges and payments</p>
    </div>

    <!-- Show charges for selected folio -->
    <div *ngIf="selectedFolio && !loading">
      <!-- Folio Header Info -->
      <div class="px-4 py-3 bg-gray-50 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div>
          </div>
          <div class="text-right">
            <span class="text-xs text-gray-500">Created by</span>
            <span class="text-xs font-medium text-gray-700 ml-1">{{ selectedFolio.createdBy }}</span>
          </div>
        </div>
      </div>

      <table class="min-w-full text-xs">
        <thead>
        <tr class="bg-gray-50 border-b border-gray-200">
          <th class="w-8 px-3 py-2 text-left">
            <input type="checkbox" class="h-3 w-3 rounded border-gray-300">
          </th>
          <th class="px-3 py-2 text-left font-medium text-gray-600">Date</th>
          <th class="px-3 py-2 text-left font-medium text-gray-600">Ref No.</th>
          <th class="px-3 py-2 text-left font-medium text-gray-600">Type</th>
          <th class="px-3 py-2 text-left font-medium text-gray-600">Description</th>
          <th class="px-3 py-2 text-center font-medium text-gray-600">Qty</th>
          <th class="px-3 py-2 text-left font-medium text-gray-600">Posted By</th>
          <th class="px-3 py-2 text-right font-medium text-gray-600">Amount</th>
          <th class="w-8 px-3 py-2"></th>
        </tr>
        </thead>
        <tbody>
        <!-- Display charges from selected folio -->
        <tr
          *ngFor="let charge of selectedFolio.charges"
          class="border-b border-gray-100 hover:bg-gray-50">
          <td class="px-3 py-2">
            <input type="checkbox" class="h-3 w-3 rounded border-gray-300">
          </td>
          <td class="px-3 py-2 text-gray-700">{{ formatDate(charge.chargeDate) }}</td>
          <td class="px-3 py-2 text-gray-700">{{ charge.id || '-' }}</td>
          <td class="px-3 py-2 text-gray-700">{{ charge.chargeType }}</td>
          <td class="px-3 py-2 text-gray-700">{{ charge.description }}</td>
          <td class="px-3 py-2 text-center text-gray-700">{{ charge.quantity }}</td>
          <td class="px-3 py-2 text-gray-700">{{ charge.postedBy }}</td>
          <td class="px-3 py-2 text-right text-gray-700 font-medium">{{ formatCurrency(charge.totalAmount) }}</td>
          <td class="px-3 py-2 text-right">
            <button class="text-gray-400 hover:text-gray-600">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
              </svg>
            </button>
          </td>
        </tr>

        <!-- No charges message -->
        <tr *ngIf="selectedFolio.charges.length === 0">
          <td colspan="9" class="px-3 py-12 text-center">
            <svg class="w-12 h-12 mx-auto text-gray-300 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
            <p class="text-gray-500 text-sm font-medium">No charges posted yet</p>
            <p class="text-gray-400 text-xs mt-1">Click "Add Charges" to post charges to this folio</p>
          </td>
        </tr>
        </tbody>
      </table>

      <!-- End of Data indicator -->
      <div class="px-3 py-4 text-xs text-center text-gray-400" *ngIf="selectedFolio.charges.length > 0">
        <div class="flex items-center justify-center gap-2">
          <div class="h-px w-12 bg-gray-300"></div>
          <span>End of Data</span>
          <div class="h-px w-12 bg-gray-300"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer Summary -->
<div class="border-t border-gray-200 bg-gray-50 px-4 py-3" *ngIf="selectedFolio">
  <div class="flex justify-between items-center">
    <div class="flex gap-8 text-sm">
      <div class="text-gray-600">
        <span class="font-medium">Total Charges:</span>
        <span class="font-semibold ml-2 text-gray-800">Rs. {{ formatCurrency(selectedFolio.totalCharges) }}</span>
      </div>
      <div class="text-gray-600">
        <span class="font-medium">Total Payments:</span>
        <span class="font-semibold ml-2 text-green-600">Rs. {{ formatCurrency(selectedFolio.totalPayments) }}</span>
      </div>
    </div>
    <div class="text-sm">
      <span class="font-medium text-gray-600">Balance:</span>
      <span
        class="font-bold ml-2 text-base"
        [class.text-red-600]="selectedFolio.balance > 0"
        [class.text-green-600]="selectedFolio.balance === 0"
        [class.text-gray-600]="selectedFolio.balance < 0">
        Rs. {{ formatCurrency(selectedFolio.balance) }}
      </span>
    </div>
  </div>
</div>


