<div class="bg-gradient-to-br from-gray-50 to-gray-100 py-4 px-4">
  <div class="mx-auto">

    <div class="mb-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center shadow-lg">
            <mat-icon class="!text-white !w-5 !h-5 !text-[20px]">build</mat-icon>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gray-900">Maintenance Requests</h1>
            <p class="text-gray-500 mt-1">Manage maintenance issues for {{ propertyName }}</p>
          </div>
        </div>

        <div class="flex items-center gap-1">
          <mat-form-field
            appearance="outline"
            class="!h-9 w-44 !subscript-wrapper-none compact-select-field">
            <mat-label class="!text-xs">Status</mat-label>
            <mat-select
              [(ngModel)]="selectedStatus"
              (selectionChange)="onFilterChange()"
              disableOptionCentering
              class="!text-sm">
              <mat-select-trigger class="!py-1">
            <span class="font-medium text-indigo-700 truncate mt-2">
              {{ selectedStatus === 'ALL' ? 'All Requests' : (selectedStatus | titlecase) }}
            </span>
              </mat-select-trigger>
              <mat-option *ngFor="let status of statusOptions" [value]="status.value" class="!py-1 !h-auto">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 rounded-full flex-shrink-0"
                       [class]="status.value === 'ALL'
                     ? 'bg-gray-400'
                     : getStatusClass(status.value).split(' ')[0].replace('bg-', 'bg-').replace('-100', '-500')">
                  </div>
                  <span class="truncate">{{ status.label }}</span>
                </div>
              </mat-option>
            </mat-select>
            <mat-icon matPrefix class="!text-gray-400 !w-4 !h-4 !mb-0.5 !text-sm">search</mat-icon>
          </mat-form-field>

          <mat-form-field
            appearance="outline"
            class="!h-9 w-44 !subscript-wrapper-none compact-select-field ml-2">
            <mat-label class="!text-xs">Type</mat-label>
            <mat-select
              [(ngModel)]="selectedType"
              (selectionChange)="onFilterChange()"
              disableOptionCentering
              class="!text-sm">
              <mat-select-trigger class="!py-1">
            <span class="font-medium text-indigo-700 truncate mt-2">
              {{ selectedType === 'ALL' ? 'All Types' : selectedType }}
            </span>
              </mat-select-trigger>
              <mat-option *ngFor="let type of typeOptions" [value]="type.value" class="!py-1 !h-auto">
                <div class="flex items-center gap-2">
                  <mat-icon class="!w-4 !h-4 !text-[16px]">{{ type.icon }}</mat-icon>
                  <span class="truncate">{{ type.label }}</span>
                </div>
              </mat-option>
            </mat-select>
            <mat-icon matPrefix class="!text-gray-400 !w-4 !h-4 !mb-0.5 !text-sm">filter_list</mat-icon>
          </mat-form-field>
        </div>
      </div>
    </div>

    <mat-card class="!shadow-xl !rounded-xl overflow-hidden">
      <mat-card-content class="!p-0">

        <div *ngIf="isLoading" class="flex items-center justify-center py-16">
          <mat-spinner diameter="50"></mat-spinner>
        </div>

        <div *ngIf="!isLoading && requests.length === 0" class="flex flex-col items-center justify-center py-16 px-4">
          <mat-icon class="!w-20 !h-20 !text-[80px] !text-gray-300 mb-4">build</mat-icon>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">No {{ selectedStatus !== 'ALL' ? (selectedStatus | titlecase) : '' }} Requests Found</h3>
          <p class="text-gray-500 mb-6">
            {{ selectedStatus !== 'ALL' ? 'Try changing the filter or create a new request.' : 'There are no maintenance requests yet.' }}
          </p>
          <button
            mat-raised-button
            color="primary"
            (click)="createMaintenanceRequest()"
            class="!rounded-lg">
            <mat-icon class="!mr-2">add</mat-icon>
            Create Request
          </button>
        </div>

        <div *ngIf="!isLoading && requests.length > 0" class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"></th>
              <th class="py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Room</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Type</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Priority</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Assigned To</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Reported</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
            </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200 text-xs">
            <tr *ngFor="let request of requests; let i = index"
                [ngClass]="i % 2 === 0 ? 'bg-white hover:bg-gray-50' : 'bg-gray-50 hover:bg-gray-100'"
                class="transition-colors duration-150 border-b border-gray-200">

              <td class="px-4 py-3 whitespace-nowrap"><span class="font-semibold text-gray-500">{{ i + 1 }}</span></td>

              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="w-10 h-10 rounded-lg bg-indigo-50 flex items-center justify-center text-indigo-600 font-bold shadow-sm border border-indigo-100">
                    {{ request.roomNumber }}
                  </div>
                  <div class="ml-3">
                    <div class="font-bold text-gray-900">Room {{ request.roomNumber }}</div>
                    <div class="text-xs text-gray-500 flex items-center gap-1">
                      {{ request.roomType }}
                    </div>
                  </div>
                </div>
              </td>

              <td class="px-4 py-3 max-w-xs">
                <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide w-fit"
                      [ngClass]="getMaintenanceTypeClass(request.maintenanceType)">
                      <mat-icon class="!w-3 !h-3 !text-[12px] mr-1">{{ getMaintenanceTypeIcon(request.maintenanceType) }}</mat-icon>
                  {{ request.maintenanceType }}
                </span>
              </td>

              <td class="px-4 py-3 whitespace-nowrap">
                <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide w-fit"
                      [ngClass]="getPriorityClass(request.priority)">
                    {{ request.priority }}
                </span>
              </td>

              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center" *ngIf="request.assignedToName; else unassigned">
                  <span class="ml-2 font-medium text-gray-700 truncate max-w-[120px]" [matTooltip]="request.assignedToName">
                      {{ request.assignedToName }}
                    </span>
                </div>
                <ng-template #unassigned>
                    <span class="text-gray-400 italic flex items-center">
                      <mat-icon class="!w-4 !h-4 !text-[16px] mr-1">person_off</mat-icon>
                      Unassigned
                    </span>
                </ng-template>
              </td>

              <td class="px-4 py-3 whitespace-nowrap">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                        [ngClass]="getStatusClass(request.status)">
                    <span class="w-2 h-2 rounded-full mr-2"
                          [class.bg-green-500]="request.status === 'COMPLETED'"
                          [class.bg-yellow-500]="request.status === 'PENDING'"
                          [class.bg-purple-500]="request.status === 'IN_PROGRESS'"
                          [class.bg-blue-500]="request.status === 'ASSIGNED'"
                          [class.bg-red-500]="request.status === 'REJECTED'"
                          [class.bg-gray-500]="request.status === 'CANCELLED'">
                    </span>
                    {{ request.status }}
                  </span>
              </td>

              <td class="px-4 py-3 whitespace-nowrap text-gray-700">
                <div class="flex flex-col">
                  <div class="flex items-center">
                    <mat-icon class="!w-4 !h-4 !text-[16px] !text-gray-400 mr-1">event</mat-icon>
                    <span class="font-medium">{{ request.reportedAt | date:'MMM d, y' }}</span>
                  </div>
                  <div class="flex items-center mt-1 text-gray-500">
                    <mat-icon class="!w-4 !h-4 !text-[16px] !text-gray-400 mr-1">schedule</mat-icon>
                    <span>{{ request.reportedAt | date:'shortTime' }}</span>
                  </div>
                </div>
              </td>

              <td class="px-4 py-3 whitespace-nowrap text-center">
                <div class="flex items-center justify-center">
                  <button
                    mat-icon-button
                    matTooltip="View Details"
                    (click)="viewDetails(request)"
                    class="!transition-all !duration-200">
                    <mat-icon class="action-icon">visibility</mat-icon>
                  </button>

                  <!-- Assign button - only show for PENDING status -->
                  <button
                    mat-icon-button
                    matTooltip="Assign User"
                    (click)="assignMaintenance(request)"
                    class="!transition-all !duration-200">
                    <mat-icon class="action-icon">person_add</mat-icon>
                  </button>

                  <button
                    *ngIf="request.status === 'ASSIGNED'"
                    mat-icon-button
                    matTooltip="Start Work"
                    (click)="startMaintenance(request)"
                    class="!transition-all !duration-200">
                    <mat-icon class="action-icon">play_arrow</mat-icon>
                  </button>

                  <button
                    *ngIf="request.status === 'IN_PROGRESS'"
                    mat-icon-button
                    matTooltip="Complete Work"
                    (click)="completeMaintenance(request)"
                    class="!transition-all !duration-200">
                    <mat-icon class="action-icon">check_circle</mat-icon>
                  </button>

                  <button
                    mat-icon-button
                    matTooltip="Delete Request"
                    (click)="deleteRequest(request)"
                    class="!transition-all !duration-200">
                    <mat-icon class="action-icon">delete</mat-icon>
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
